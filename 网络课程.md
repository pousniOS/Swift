# linux网络编程课程介绍

1. linux网络编程之TCP/IP基础篇
2. linux网络编程之socket编程遍
3. linux网络编程之线程篇
4. linux网络编程之实战篇(miniftpd实现)

# 第一章
## ISO/OSI参考模型
### OSI（open system interconnection）开发系统互联模型是由ISO（international Organization for standardization）国际化标准组织定义的网络分层模型，共七层。   

1. ISO/OSI的七层网络模型    

| 主机A|| 主机B||传输的单位|
|:----:|:----:|:----:|:----:|:----:|
|应用层|<---应用层协议--->|应用层|提供应用程序间通信|apud|
|表示层|<---表示层协议--->|表示层|处理数据格式、数据加密等|ppud|
|会话层|<---会话层协议--->|会话层|建立、维护和管理回话|supd|
|传输层|<---传输层协议--->|传输层|建立端到端连接|segment|
|网络层|<---网络层协议--->|网络层|寻址和路由器选择|packet|
|数据链路层|<---链路层协议--->|数据链路层|介质访问，链路管理|frame|
|物理层|<---物理层协议--->|物理层|比特流传输|bit|

2. 不同层次的功能特性

+ 物理层（physical layer）：物理层定义了所有电子及物理设备的规范，为上层的传输层提供了一个物理介质，本层中数据传输的单位为bit。属于本层定义的规范有EIA/TIA RS-232、EIA/TIA RS-449、V.35、RJ-45等，实际使用的设备如网卡等属于本层。

+ 数据链路层（data link layer）：对物理层收到的bit数据进行数据成帧。提供可靠的数据传输服务，实现无差距数据传输。在数据链路层中数据的单位为帧（frame）。属于本层定义的规范有SDLC、HDLC、PPP、STP、帧中继等，实际使用的设备如switch交换机属于本层。

+ 网络层（network layer）：网络层负责将各个子网之间的数据进行路由选择，分组与重组。本层中数据传输的单位为数据包（packet）。属于本层协议规范有IP、IPX、OSPF、ICMP、IGMP等。实际使用的设备如路由器属于本层。

+ 传输层（transport layer）：提供可靠的数据传输服务，它检测路由器丢弃的包，然后产生一个重传请求，能够将乱序收到的数据包重新排序。

+ 会话层（session layer）：管理主机之间回话过程，包括会话建立、终止和会话过程中的管理。

+ 表示层（Presentation layer）：表示层对网络传输的数据进行交换，使得多个主机之间传输的信息可以相互理解，包括数据的压缩、加密、格式转换等。

+ 应用层（application layer）：应用层与应用程序界面沟通，以达至展示给用户的目的，再次常见的有：HTTP、HTTPS、FTP、TELNET、SSH、SMTP、POP3等。

## TCP/IP四层模型

### 理想七层模型和实际四层模型对应关系

|七层模型|四层模型|重要的协议|
|:----:|:----:|:----:|
|应用层application layer<br>表示层presentation layer<br>会话层Session layer|应用层application layer|HTTP、HTTPS、FTP|
|传输层 transport layer<br>|传输层transport layer|TCP、UDP|
|网络层 internet layer|网络层 internet layer|ICMP、IP、IGMP|
|数据链路层 data link layer<br>物理层physical layer|链路层 link layer|ARP、RARP|

## 基本概念(对等通信、封装、分用、端口)
### 对等通信
1. 主机之间同一层级之间的通信称之为对等通信
2. 虚电路：一个客户端软件跟服务器软件进行通信我们就好像是双方建立了一个连接
3. 真实的数据流是：客应用层->客传输层->网络层->链路层->主链路层->网络层->传输层->应用层
4. 对等层传输的数据我们可以把他看做是逻辑流

### 封装（encapsulation）
1. 数据封装流程    

|步骤：||
|:----:|:----:|
|第一步|{用户数据}|
|第二步|{app首部\|用户数据}|
|第三步|{TCP首部\|app首部\|用户数据}|
|第四步|{IP首部\|TCP首部\|app首部\|用户数据}|
|第五步|{以太网首部（14字节 其中包含协议类型）\|IP首部（20字节）\|TCP首部（20字节）\|app首部\|用户数据\|以太网尾部（4字节）}|

2. 以太网帧的大小为46~1500字节

### 分用
1. 分用就是对主机在接收到客户机封装的数据帧的一个逆向过程
|步骤：||
|:----:|:----:|
|第一步|解析以太网数据帧的首部数据，获取当前协议类型（假如是ip协议）然后将去掉首部的数据分配给ip协议|
|第二步|IP协议程序解析IP协议首部，获得IP协议值（假如是TCP）根据IP协议值将去掉IP首部的数据分配给TCP协议|
|第三步|{TCP会去掉TCP的首部，将数据分用给应用层（根据端口号决定）|app首部|用户数据}|

### 端口号

1. 众所周知端口（well known ports）：从0到1023，这些端口由IANA分配和控制他们紧密绑定与一些服务。通常这些端口的通讯明确表明某种服务的协议。例如：21端口为ftp服务端口。

2. 注册端口（register ports）：从1024到49151。这些端口不受IANA控制，但IANA登记并提供使用清单。他们松散的绑定于一些服务。也就是说有许多服务绑定于这些端口，这些端口同样用于许多其它的目的。例如：1443 Microsoft SQL服务器端口

3. 动态或私有端口（Dynamic or Private Ports）：从49152到65535 IANA不管这些端口。实际上，机器通常从1024起分配动态端口。但也有例外：SUN的RPC端口从32768开始。

4. IP不能标识一个主机上的应用程序，数据到达主机的时候如何区分数分用给那个应用程序呢？那这个时候就需要端口号来标识不同的应用程序。

# 第二章
## TCP/PI基础（二）

### 最大传输单元（MTU）/路径MTU

1. 以太网和IEEE 802.3对数据帧的长度都有限制，其最大值分别是1500和1492字节，将这个限制称做最大传输单元（MTU，Maximum Transmission Unit）。

2. 如果IP层一个数据报要传，而且数据长度比链路层的MTU还大，那么IP层就要进行分片（fragmentation），把数据报分成若干片，这样每一片都小于MTU。


3. 当网络上的两台主机相互通信时，两台主机要经过多个网络，每个网络可能有不同的MTU，其中两台通信主机路径中最小MTU被称作MTU。

### 以太网帧格式

1. 以太网封装(RFC 894):

+ {目的地址[^6] |  源地址[^6]  |  类型[^2]| 数据[^46~1500] |CRC[^4]} 

+ {类型[^2] (0800) | IP数据报[^46~1500]}

+ {类型[^2] 0806 | ARP请求/应答[^28] | PAD[^18]}

+ {类型[^2] 8035 | RARP请求/应答[^28] | PAD[^18]}    

2. 用于以太网的ARP请求或应答分组格式

+ {以太网目的地址[^6]  | 以太网源地址[^6]  | 帧类型 [^2] | 硬件类型[^2] | 协议类型[^2] | 硬件地址长度[^1] | 协议地址长度[^1] | op[^2] | 发送端以太网地址[^6] | 发送端IP地址[^4] | 目的以太网地址[^6] | 目的IP地址[^4] }

  { |<-------   以太网首部   --------->|<----------------------------------------------------   28字节ARP请求应答   ------------------------------------------------------>| }

3. 对于链路层来说它只识别物理地址（mac地址），IP可以理解为是一个逻辑地址在IP地址转换成mac地址的过程叫做地址解析
4. IP---->MAC 地址解析(ARP协议)、MAC---->IP 反向地址解析(RARP协议)
5. 


### ICMP
### ARP
### RARP


